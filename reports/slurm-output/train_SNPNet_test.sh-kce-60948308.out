Activating virtual environment:  SNPNet
/faststorage/project/NLPPred/snp-compression/SNPNet/bin/python
Training SNPNet
wandb: Currently logged in as: kenevoldsen (use `wandb login --relogin` to force relogin)
wandb: Tracking run with wandb version 0.12.10
wandb: Syncing run pious-snowball-49
wandb: ‚≠êÔ∏è View project at https://wandb.ai/kenevoldsen/snp-compression
wandb: üöÄ View run at https://wandb.ai/kenevoldsen/snp-compression/runs/1zxbbg4f
wandb: Run data is saved locally in /home/kce/NLPPred/snp-compression/models/wandb/run-20220221_182455-1zxbbg4f
wandb: Run `wandb offline` to turn off syncing.
Using 16bit native Automatic Mixed Precision (AMP)
GPU available: True, used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Set SLURM handle signals.

FIT Profiler Report

Action                             	|  Mean duration (s)	|Num calls      	|  Total time (s) 	|  Percentage %   	|
--------------------------------------------------------------------------------------------------------------------------------------
Total                              	|  -              	|_              	|  10.498         	|  100 %          	|
--------------------------------------------------------------------------------------------------------------------------------------
get_sanity_check_batch             	|  0.57031        	|3              	|  1.7109         	|  16.298         	|
fetch_next_sanity_check_batch      	|  0.57028        	|3              	|  1.7108         	|  16.297         	|
evaluation_step_and_end            	|  0.29095        	|2              	|  0.58189        	|  5.5431         	|
validation_step                    	|  0.29085        	|2              	|  0.5817         	|  5.5413         	|
run_training_epoch                 	|  0.34059        	|1              	|  0.34059        	|  3.2445         	|
get_train_batch                    	|  0.091775       	|1              	|  0.091775       	|  0.87425        	|
fetch_next_train_batch             	|  0.09171        	|1              	|  0.09171        	|  0.87363        	|
evaluation_batch_to_device         	|  0.0034019      	|2              	|  0.0068038      	|  0.064813       	|
on_train_start                     	|  0.0028492      	|1              	|  0.0028492      	|  0.027141       	|
configure_optimizers               	|  0.0014822      	|1              	|  0.0014822      	|  0.01412        	|
on_validation_model_eval           	|  0.0011381      	|1              	|  0.0011381      	|  0.010841       	|
on_validation_batch_start          	|  4.4037e-05     	|2              	|  8.8073e-05     	|  0.00083899     	|
teardown                           	|  3.6409e-05     	|1              	|  3.6409e-05     	|  0.00034683     	|
on_configure_sharded_model         	|  3.605e-05      	|1              	|  3.605e-05      	|  0.00034341     	|
setup                              	|  3.1896e-05     	|1              	|  3.1896e-05     	|  0.00030384     	|
on_pretrain_routine_start          	|  3.1624e-05     	|1              	|  3.1624e-05     	|  0.00030125     	|
on_train_epoch_end                 	|  3.0488e-05     	|1              	|  3.0488e-05     	|  0.00029043     	|
on_sanity_check_start              	|  2.7051e-05     	|1              	|  2.7051e-05     	|  0.00025769     	|
configure_callbacks                	|  2.6675e-05     	|1              	|  2.6675e-05     	|  0.00025411     	|
on_epoch_start                     	|  1.1983e-05     	|2              	|  2.3967e-05     	|  0.00022831     	|
on_validation_start                	|  2.3011e-05     	|1              	|  2.3011e-05     	|  0.0002192      	|
on_validation_batch_end            	|  1.1345e-05     	|2              	|  2.2691e-05     	|  0.00021615     	|
on_validation_end                  	|  2.075e-05      	|1              	|  2.075e-05      	|  0.00019766     	|
on_train_end                       	|  2.0165e-05     	|1              	|  2.0165e-05     	|  0.00019209     	|
on_validation_epoch_start          	|  1.9161e-05     	|1              	|  1.9161e-05     	|  0.00018253     	|
on_before_accelerator_backend_setup	|  1.8356e-05     	|1              	|  1.8356e-05     	|  0.00017486     	|
validation_step_end                	|  7.9842e-06     	|2              	|  1.5968e-05     	|  0.00015212     	|
on_pretrain_routine_end            	|  1.5303e-05     	|1              	|  1.5303e-05     	|  0.00014578     	|
on_sanity_check_end                	|  1.4769e-05     	|1              	|  1.4769e-05     	|  0.00014069     	|
on_epoch_end                       	|  7.3034e-06     	|2              	|  1.4607e-05     	|  0.00013914     	|
on_validation_epoch_end            	|  1.4348e-05     	|1              	|  1.4348e-05     	|  0.00013668     	|
configure_sharded_model            	|  1.2308e-05     	|1              	|  1.2308e-05     	|  0.00011725     	|
on_val_dataloader                  	|  1.0364e-05     	|1              	|  1.0364e-05     	|  9.8725e-05     	|
val_dataloader                     	|  1.0259e-05     	|1              	|  1.0259e-05     	|  9.7731e-05     	|
prepare_data                       	|  8.0615e-06     	|1              	|  8.0615e-06     	|  7.6794e-05     	|
on_train_epoch_start               	|  6.5286e-06     	|1              	|  6.5286e-06     	|  6.2191e-05     	|
on_train_dataloader                	|  5.8003e-06     	|1              	|  5.8003e-06     	|  5.5253e-05     	|
train_dataloader                   	|  3.6191e-06     	|1              	|  3.6191e-06     	|  3.4476e-05     	|

LR finder stopped early after 0 steps due to diverging loss.
Restoring states from the checkpoint path at /home/kce/NLPPred/snp-compression/models/lr_find_temp_model_c780af8b-5288-4bbb-a43b-ff957993ae63.ckpt
Failed to compute suggesting for `lr`. There might not be enough points.
Traceback (most recent call last):
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/tuner/lr_finder.py", line 176, in suggestion
    min_grad = np.gradient(loss).argmin()
  File "<__array_function__ internals>", line 180, in gradient
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/numpy/lib/function_base.py", line 1195, in gradient
    raise ValueError(
ValueError: Shape of array too small to calculate a numerical gradient, at least (edge_order + 1) elements are required.
Failed to compute suggesting for `lr`. There might not be enough points.
Traceback (most recent call last):
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/tuner/lr_finder.py", line 176, in suggestion
    min_grad = np.gradient(loss).argmin()
  File "<__array_function__ internals>", line 180, in gradient
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/numpy/lib/function_base.py", line 1195, in gradient
    raise ValueError(
ValueError: Shape of array too small to calculate a numerical gradient, at least (edge_order + 1) elements are required.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Set SLURM handle signals.

  | Name     | Type                 | Params
--------------------------------------------------
0 | model    | DenoisingAutoencoder | 574 K 
1 | loss     | CrossEntropyLoss     | 0     
2 | accuracy | Accuracy             | 0     
3 | f1       | F1Score              | 0     
4 | conf_mat | ConfusionMatrix      | 0     
--------------------------------------------------
574 K     Trainable params
0         Non-trainable params
574 K     Total params
1.148     Total estimated model params size (MB)
Validation sanity check: 0it [00:00, ?it/s]Validation sanity check:   0% 0/2 [00:00<?, ?it/s]/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loggers/wandb.py:341: UserWarning:

There is a wandb run already in progress and newly created instances of `WandbLogger` will reuse this run. If this is not desired, call `wandb.finish()` before instantiating `WandbLogger`.

Traceback (most recent call last):
  File "src/train/train.py", line 112, in <module>
    main()
  File "src/train/train.py", line 105, in main
    trainer.fit(model, train_dataloaders=train_loader, val_dataloaders=val_loader)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 740, in fit
    self._call_and_handle_interrupt(
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 685, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 777, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 1199, in _run
    self._dispatch()
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 1279, in _dispatch
    self.training_type_plugin.start_training(self)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 202, in start_training
    self._results = trainer.run_stage()
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 1289, in run_stage
    return self._run_train()
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 1311, in _run_train
    self._run_sanity_check(self.lightning_module)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 1375, in _run_sanity_check
    self._evaluation_loop.run()
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loops/base.py", line 145, in run
    self.advance(*args, **kwargs)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loops/dataloader/evaluation_loop.py", line 110, in advance
    dl_outputs = self.epoch_loop.run(dataloader, dataloader_idx, dl_max_batches, self.num_dataloaders)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loops/base.py", line 145, in run
    self.advance(*args, **kwargs)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loops/epoch/evaluation_epoch_loop.py", line 122, in advance
    output = self._evaluation_step(batch, batch_idx, dataloader_idx)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/loops/epoch/evaluation_epoch_loop.py", line 217, in _evaluation_step
    output = self.trainer.accelerator.validation_step(step_kwargs)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/accelerators/accelerator.py", line 239, in validation_step
    return self.training_type_plugin.validation_step(*step_kwargs.values())
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 219, in validation_step
    return self.model.validation_step(*args, **kwargs)
  File "./src/models/pl_wrappers.py", line 118, in validation_step
    self.logger.experiment.log(
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 1349, in log
    self.history._row_add(data)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/wandb_history.py", line 44, in _row_add
    self._flush()
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/wandb_history.py", line 59, in _flush
    self._callback(row=self._data, step=self._step)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 1027, in _history_callback
    self._backend.interface.publish_history(
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/interface/interface.py", line 496, in publish_history
    data = data_types.history_dict_to_json(run, data, step=step)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/data_types.py", line 2591, in history_dict_to_json
    payload[key] = val_to_json(run, key, val, namespace=step)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/data_types.py", line 2616, in val_to_json
    val = Plotly.make_plot_media(val)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/sdk/data_types.py", line 2540, in make_plot_media
    val = util.matplotlib_to_plotly(val)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/wandb/util.py", line 510, in matplotlib_to_plotly
    return tools.mpl_to_plotly(obj)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/plotly/tools.py", line 112, in mpl_to_plotly
    matplotlylib.Exporter(renderer).run(fig)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/plotly/matplotlylib/mplexporter/exporter.py", line 53, in run
    self.crawl_fig(fig)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/plotly/matplotlylib/mplexporter/exporter.py", line 124, in crawl_fig
    self.crawl_ax(ax)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/plotly/matplotlylib/mplexporter/exporter.py", line 146, in crawl_ax
    self.draw_collection(ax, collection)
  File "/faststorage/project/NLPPred/snp-compression/SNPNet/lib/python3.8/site-packages/plotly/matplotlylib/mplexporter/exporter.py", line 289, in draw_collection
    offset_order = offset_dict[collection.get_offset_position()]
AttributeError: 'QuadMesh' object has no attribute 'get_offset_position'
wandb: ERROR Problem finishing run
/home/kce/miniconda3/envs/snp-compression/lib/python3.8/multiprocessing/resource_tracker.py:216: UserWarning: resource_tracker: There appear to be 6 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
